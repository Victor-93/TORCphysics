# Tracking of RNAP by Topoisomerase I from ChIP-seq Data

This folder contains Python scripts used to calibrate topoisomerase I tracking of RNA polymerase (RNAP), based on ChIP-seq data from Sutormin et al., *‚ÄúInteraction between transcribing RNA polymerase and topoisomerase I prevents R-loop formation in *E. coli*‚Äù*.

---

## üõ†Ô∏è General Instructions

### üßπ Preprocessing

1. Navigate to `preprocess/`.
2. Run `run_simulation.py` ‚Äì this generates `position*` files (position data from simulations without RNAP).
3. Run `calculate_ref_density.py` ‚Äì this produces `avg_reference*` files, which are used as reference topoisomerase position densities.

### ‚öôÔ∏è Calibration

1. Go to `calibration/`.
2. Run `calibrate.py` ‚Äì this performs random search calibration. It outputs:

   * `*.csv`: best parameter sets,
   * `*values.csv`: iteration logs and scores.

### üìä Analysis

1. Navigate to `analysis/`.
2. Run `calculate_averages.py` ‚Äì computes averaged best-fit parameter sets (`avgx2*` files).
3. Run `plot_loss.py` ‚Äì visualises the distribution of losses.
4. Return to `calibration/` and run `reproduce.py` ‚Äì simulates with the averaged parameters and outputs `avx2**.pkl`.
5. Back in `analysis/`, run `plot_calibration.py` ‚Äì plots fold-enrichment and final analysis.

---

## üîÑ Calibration Workflow

### Step 1 ‚Äì Reference Topoisomerase I Density (No Transcription)

Before performing the calibration, a reference position density of topoisomerase I is generated by simulating a system with no transcription, using an environment **without RNAP**. This baseline is used to compute fold enrichment when RNAP is present.

### Step 2 ‚Äì Calibration using ChIP-seq Data

We run many sets of simulations to stabilize the new position densities,
and use the reference position densities to compute the Fold enrichment,
the correlation coefficient between topoisomerase I and RNAP within the trancription unit (TU),
and the correlation of the simulated RNAP signal with the RNAP ChIP-seq signal.
Using a random search algorithm, we compute the loss function using these quantities,
and choose the set of parameterisation that minimizes the error (or loss).

---

## üß¨ Enzyme Models

**Topoisomerase I**

* *Binding*: TopoI Recognition + RNAP Tracking
* *Effect*: Linear
* *Unbinding*: Poisson

**RNA Polymerase (RNAP)**

* *Binding*: Spacer Length Model
* *Effect*: RNAP Stages + Stalling
* *Unbinding*: RNAP Stages + Simple Unbinding

---

## üì¶ Requirements (in addition to TORCphysics)

* `numpy`
* `pandas`
* `hyperopt`

---

## üìÅ Repository Contents

| File/Folder                           | Description                                                                                        |
| ------------------------------------- |----------------------------------------------------------------------------------------------------|
| `circuit.csv`                         | Circuit file                                                                                       |
| `RNAP_TU.txt`                         | Experimental RNAP signal within the transcription unit (TU) from ChIP-seq data                     |
| `preprocess/noRNAP_environment.csv`   | Environment file without RNAP                                                                      |
| `preprocess/run_simulation.py`        | Simulates reference system (no RNAP). Outputs `position*` files                                    |
| `preprocess/calculate_ref_density.py` | Converts position files into reference density histograms (`avg_reference*`)                       |
| `calibration/calibrate.py`            | Calibrates the topoisomerase model using random search. Outputs best parameters and iteration logs |
| `calibration/reproduce.py`            | Re-simulates with estimated parameter sets                                                         |
| `analysis/calculate_averages.py`      | Averages the top 10% of parameter sets to obtain estimations (`avgx2*`)                            |
| `analysis/plot_loss.py`               | Plots histogram of losses from the calibration                                                     |
| `analysis/plot_calibration.py`        | Plots fold enrichment and final analysis                                                           |

---
